<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 3.9.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"www.zdaiot.com",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="最近做了一些关于图像分割的任务，但是对于如何评价图像分割的好坏，之前自己并没有一个很深刻的了解。今天上午对这些指标进行一个总结。 图像分割中通常使用许多标准来衡量算法的精度。这些标准通常是像素精度及IoU的变种，以下我们将会介绍常用的几种逐像素标记的精度标准。为了便于解释，假设如下：共有$k+1$个类（从$L_0$到$L_k$，其中包含一个空类或背景），$p_{ij}$表示本属于类$i$但被预测为"><meta name="keywords" content="图像分割,评价指标"><meta property="og:type" content="article"><meta property="og:title" content="图像分割评价指标"><meta property="og:url" content="https://www.zdaiot.com/DeepLearningApplications/图像分割/图像分割评价指标/index.html"><meta property="og:site_name" content="zdaiot"><meta property="og:description" content="最近做了一些关于图像分割的任务，但是对于如何评价图像分割的好坏，之前自己并没有一个很深刻的了解。今天上午对这些指标进行一个总结。 图像分割中通常使用许多标准来衡量算法的精度。这些标准通常是像素精度及IoU的变种，以下我们将会介绍常用的几种逐像素标记的精度标准。为了便于解释，假设如下：共有$k+1$个类（从$L_0$到$L_k$，其中包含一个空类或背景），$p_{ij}$表示本属于类$i$但被预测为"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://www.zdaiot.com/DeepLearningApplications/图像分割/图像分割评价指标/Screenshot_20from_202018-01-12_2011-33-36.png"><meta property="og:image" content="https://www.zdaiot.com/DeepLearningApplications/图像分割/图像分割评价指标/webwxgetmsgimg1562208533869.png"><meta property="og:image" content="https://www.zdaiot.com/DeepLearningApplications/图像分割/图像分割评价指标/Screenshot_20from_202018-01-12_2011-33-36.png"><meta property="og:updated_time" content="2019-09-12T11:15:24.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="图像分割评价指标"><meta name="twitter:description" content="最近做了一些关于图像分割的任务，但是对于如何评价图像分割的好坏，之前自己并没有一个很深刻的了解。今天上午对这些指标进行一个总结。 图像分割中通常使用许多标准来衡量算法的精度。这些标准通常是像素精度及IoU的变种，以下我们将会介绍常用的几种逐像素标记的精度标准。为了便于解释，假设如下：共有$k+1$个类（从$L_0$到$L_k$，其中包含一个空类或背景），$p_{ij}$表示本属于类$i$但被预测为"><meta name="twitter:image" content="https://www.zdaiot.com/DeepLearningApplications/图像分割/图像分割评价指标/Screenshot_20from_202018-01-12_2011-33-36.png"><link rel="canonical" href="https://www.zdaiot.com/DeepLearningApplications/图像分割/图像分割评价指标/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>图像分割评价指标 | zdaiot</title><script data-pjax>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?0b0b58037319da4959d5a3c014160ccd";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">zdaiot</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">404NotFound</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.zdaiot.com/DeepLearningApplications/图像分割/图像分割评价指标/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/uploads/avatar.png"><meta itemprop="name" content="zdaiot"><meta itemprop="description" content="404NotFound"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="zdaiot"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 图像分割评价指标<a href="https://github.com/zdaiot/zdaiot.github.io/tree/hexo/source/_posts/DeepLearningApplications/图像分割/图像分割评价指标.md" class="post-edit-link" title="编辑" rel="noopener" target="_blank"><i class="fa fa-pencil-alt"></i></a></h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-07-04 10:10:13" itemprop="dateCreated datePublished" datetime="2019-07-04T10:10:13+08:00">2019-07-04</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2019-09-12 19:15:24" itemprop="dateModified" datetime="2019-09-12T19:15:24+08:00">2019-09-12</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/DeepLearningApplications/" itemprop="url" rel="index"><span itemprop="name">DeepLearningApplications</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/DeepLearningApplications/图像分割/" itemprop="url" rel="index"><span itemprop="name">图像分割</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>6.4k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span>6 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>最近做了一些关于图像分割的任务，但是对于如何评价图像分割的好坏，之前自己并没有一个很深刻的了解。今天上午对这些指标进行一个总结。</p><p>图像分割中通常使用许多标准来衡量算法的精度。这些标准通常是像素精度及IoU的变种，以下我们将会介绍常用的几种逐像素标记的精度标准。为了便于解释，假设如下：共有$k+1$个类（从$L_0$到$L_k$，其中包含一个空类或背景），$p_{ij}$表示本属于类$i$但被预测为类$j$的像素<strong>数量</strong>。即$p_{ii}$表示真正的<strong>数量</strong>，而$p_{ij}, p_{ji}$则分别被解释为假正和假负，尽管两者分别为假正与假负数量之和。</p><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p>如下图所示，红色圆代表真实值，黄色圆代表预测值。橙色部分红色圆与黄色圆的交集，即真正（预测为1，真实值为1）的部分，红色部分表示假负（预测为0，真实为1）的部分，黄色表示假正（预测为1，真实为0）的部分，两个圆之外的白色区域表示真负（预测为0，真实值为0）的部分。</p><p>如何理解上面在说明真正、假负、假正、真负时用到的0和1呢？这个我觉得这么解释可能更加清晰。</p><ul><li>真正（TP）：真实为这个类，预测结果也为这个类，即橙色部分。预测正确（True），预测为了正样本（positive）；真的正值，说明被预测为正样本，预测是真的，即真实值为正样本</li><li>假负（FN）：真正为这个类，预测结果不是这个类，即红色部分。预测错了（False），预测为了负样本（negative）；假的负值，说明被预测为负样本，但预测是假的，即真实值为正样本</li><li>假正（FP）：真正不是这个类，预测结果为这个类，即黄色部分。预测错了（False），预测为了正样本（positive）；假的正直：说明被预测为正样本，但预测是假的，即真实值为负样本</li><li>真负（TN）：真正不是这个类，预测结果不是这个类，即白色部分。预测正确（True），预测为了负样本（negative）；真的负值，说明被预测为负样本，预测是真的，即真实值为负样本</li></ul><p><img src="/DeepLearningApplications/图像分割/图像分割评价指标/Screenshot_20from_202018-01-12_2011-33-36.png" alt></p><h3 id="precesion"><a href="#precesion" class="headerlink" title="precesion"></a>precesion</h3><p>针对预测样本而言，预测为正例的样本中真正为真样本的比例：<br>预测为正的有两种：<br>1、正样本被预测为正 TP<br>2、负样本被预测为正 FP</p><p>所以精确率：</p><script type="math/tex;mode=display">precesion = TP/(TP+FP)</script><p>其中分母预测为正样本数量。</p><h3 id="recall"><a href="#recall" class="headerlink" title="recall"></a>recall</h3><p>针对原来的样本而言，表示样本中有多少正例被预测正确了（预测为正例的占所有真实正例的比例）：<br>1、原来的正样本被预测为正样本 TP<br>2、原来的正样本被预测为负样本 FN</p><p>所以召回率为：</p><script type="math/tex;mode=display">racall = TP/(TP+FN)</script><p>其中分母表示原来样本中的正样本数量。</p><h2 id="PA"><a href="#PA" class="headerlink" title="PA"></a>PA</h2><p>Pixel Accuracy(PA，像素精度)：这是最简单的度量，为标记正确的像素占总像素的比例。</p><script type="math/tex;mode=display">PA=\frac{\sum_{i=0}^{k}{p_{ii}}}{\sum_{i=0}^{k}\sum_{j=0}^{k}{p_{ij}}}</script><p>如何理解这个分母 呢？</p><p>如下图所示，对于一张图片一共有{0，1，2，3}4类，对于第0类，其分类情况有4种分别为{$p_{00},p_{01},p_{02},p_{03}$}，同理对于第1，2，3类均有4种情况，这也就对应了分母中的两次求和。</p><p><img src="/DeepLearningApplications/图像分割/图像分割评价指标/webwxgetmsgimg1562208533869.png" alt></p><blockquote><p>对于样本不均衡的情况，例如医学图像分割中，背景与标记样本之间的比例往往严重失衡。因此并不适合使用这种方法进行度量。</p></blockquote><h2 id="MPA"><a href="#MPA" class="headerlink" title="MPA"></a>MPA</h2><p>Mean Pixel Accuracy(MPA，均像素精度)：是PA的一种简单提升，计算每个<strong>类内</strong>被正确分类像素数的比例，之后求所有类的平均。</p><script type="math/tex;mode=display">MPA=\frac{1}{k+1}\sum_{i=0}^{k}{\frac{p_{ii}}{\sum_{j=0}^{k}{p_{ij}}}}</script><h2 id="MIoU"><a href="#MIoU" class="headerlink" title="MIoU"></a>MIoU</h2><p>Mean Intersection over Union(MIoU，均交并比)：为语义分割的标准度量。其计算两个<strong>集合</strong>的交集和并集之比，在语义分割的问题中，这两个集合为真实值（ground truth）和预测值（predicted segmentation）。这个比例可以变形为正真数（intersection）比上真正、假负、假正（并集）之和。<strong>在每个类上计算IoU，之后平均。</strong></p><script type="math/tex;mode=display">MIoU=\frac{1}{k+1}\sum_{i=0}^{k}{\frac{p_{ii}}{\sum_{j=0}^{k}{p_{ij}}+\sum_{j=0}^{k}{p_{ji}}-p_{ii}}}</script><p>那么，如何理解这里的公式呢？如下图所示，红色圆代表真实值，黄色圆代表预测值。橙色部分红色圆与黄色圆的交集，即真正（预测为1，真实值为1）的部分，红色部分表示假负（预测为0，真实为1）的部分，黄色表示假正（预测为1，真实为0）的部分，两个圆之外的白色区域表示真负（预测为0，真实值为0）的部分。</p><p><img src="/DeepLearningApplications/图像分割/图像分割评价指标/Screenshot_20from_202018-01-12_2011-33-36.png" alt></p><ul><li>MP计算橙色与（橙色与红色）的比例。</li><li>MIoU计算的是计算A与B的交集（橙色部分）与A与B的并集（红色+橙色+黄色）之间的比例，在理想状态下A与B重合，两者比例为1 。</li></ul><h2 id="FWIoU"><a href="#FWIoU" class="headerlink" title="FWIoU"></a>FWIoU</h2><p>Frequency Weighted Intersection over Union(FWIoU，频权交并比):为MIoU的一种提升，这种方法根据每个类出现的频率为其设置权重。</p><script type="math/tex;mode=display">FWIoU=\frac{1}{\sum_{i=0}^{k}{\sum_{j=0}^{k}{p_{ij}}}}\sum_{i=0}^{k}{\frac{\left(\sum_{j=0}^{k}{p_{ij}}\right)p_{ii}}{\sum_{j=0}^{k}{p_{ij}}+\sum_{j=0}^{k}{p_{ji}}-p_{ii}}}</script><p>其中，$\sum_{i=0}^{k}{\sum_{j=0}^{k}{p_{ij}}}$即为所有类的像素总数。$\sum_{j=0}^{k}{p_{ij}}$为真实情况下属于第$i$类的像素总数。$\sum_{j=0}^{k}{p_{ji}}$即为预测为第$i$类的像素总数。</p><p><strong>在以上所有的度量标准中，</strong>MIoU<strong>由于其简洁、代表性强而成为最常用的度量标准，大多数研究人员都使用该标准报告其结果。PA对于样本不均衡的情况不适用。</strong></p><h2 id="DICE"><a href="#DICE" class="headerlink" title="DICE"></a>DICE</h2><p>DICE与IOU很相似，具体两者的区别如下：</p><script type="math/tex;mode=display">\text{DC} = \frac{2 TP}{2 TP + FP + FN} = \frac{2|X \cap Y|}{|X| + |Y|}</script><script type="math/tex;mode=display">\text{IoU} = \frac{TP}{TP + FP + FN} = \frac{|X \cap Y|}{|X| + |Y| - |X \cap Y|}</script><p>从中可以看出，$\text{DC} \geq \text{IoU}$（两者相减得到的式子中分子为$|X| + |Y| - 2|X \cap Y|$，显然分子大于0）。</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">import _init_paths</span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line">import numpy as np</span><br><span class="line">from PIL import Image</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">from skimage import io</span><br><span class="line">from timer import Timer</span><br><span class="line">import cv2</span><br><span class="line">from datetime import datetime</span><br><span class="line"></span><br><span class="line">import caffe</span><br><span class="line"></span><br><span class="line">test_file = &apos;test.txt&apos;</span><br><span class="line">file_path_img = &apos;JPEGImages&apos;</span><br><span class="line">file_path_label = &apos;SegmentationClass&apos;</span><br><span class="line">save_path = &apos;output/results&apos;</span><br><span class="line"></span><br><span class="line">test_prototxt = &apos;Models/test.prototxt&apos;</span><br><span class="line">weight = &apos;Training/Seg_iter_10000.caffemodel&apos;</span><br><span class="line"></span><br><span class="line">layer = &apos;conv_seg&apos;</span><br><span class="line">save_dir = False # True</span><br><span class="line"></span><br><span class="line">if save_dir:</span><br><span class="line">    save_dir = save_path</span><br><span class="line">else:</span><br><span class="line">    save_dir = False</span><br><span class="line"></span><br><span class="line"># load net</span><br><span class="line">net = caffe.Net(test_prototxt, weight, caffe.TEST)</span><br><span class="line"></span><br><span class="line"># load test.txt</span><br><span class="line">test_img = np.loadtxt(test_file, dtype=str)</span><br><span class="line"></span><br><span class="line">def fast_hist(a, b, n):</span><br><span class="line">    k = (a &gt;= 0) &amp; (a &lt; n)</span><br><span class="line">    return np.bincount(n * a[k].astype(int) + b[k], minlength=n**2).reshape(n, n)</span><br><span class="line"></span><br><span class="line"># seg test</span><br><span class="line">print &apos;&gt;&gt;&gt;&apos;, datetime.now(), &apos;Begin seg tests&apos;</span><br><span class="line"></span><br><span class="line">n_cl = net.blobs[layer].channels</span><br><span class="line">hist = np.zeros((n_cl, n_cl))</span><br><span class="line"></span><br><span class="line"># timers</span><br><span class="line">_t = &#123;&apos;im_seg&apos; : Timer()&#125;</span><br><span class="line"></span><br><span class="line"># load image and label</span><br><span class="line">i = 0</span><br><span class="line">for img_name in test_img:</span><br><span class="line">    _t[&apos;im_seg&apos;].tic()</span><br><span class="line">    img = Image.open(os.path.join(file_path_img, img_name + &apos;.jpg&apos;))</span><br><span class="line">    img = img.resize((512, 384), Image.ANTIALIAS)</span><br><span class="line"></span><br><span class="line">    in_ = np.array(img, dtype=np.float32)</span><br><span class="line">    in_ = in_[:,:,::-1] # rgb to bgr</span><br><span class="line">    in_ -= np.array([[[68.2117, 78.2288, 75.4916]]])#数据集平均值，根据需要修改</span><br><span class="line">    in_ = in_.transpose((2,0,1))</span><br><span class="line"></span><br><span class="line">    label = Image.open(os.path.join(file_path_label, img_name + &apos;.png&apos;))</span><br><span class="line">    label = label.resize((512, 384), Image.ANTIALIAS)#图像大小（宽，高），根据需要修改</span><br><span class="line">    label = np.array(label, dtype=np.uint8)</span><br><span class="line"></span><br><span class="line">    # shape for input (data blob is N x C x H x W), set data</span><br><span class="line">    net.blobs[&apos;data&apos;].reshape(1, *in_.shape)</span><br><span class="line">    net.blobs[&apos;data&apos;].data[...] = in_</span><br><span class="line"></span><br><span class="line">    net.forward()</span><br><span class="line">    _t[&apos;im_seg&apos;].toc()</span><br><span class="line"></span><br><span class="line">    print &apos;im_seg: &#123;:d&#125;/&#123;:d&#125; &#123;:.3f&#125;s&apos; \</span><br><span class="line">          .format(i + 1, len(test_img), _t[&apos;im_seg&apos;].average_time)</span><br><span class="line">    i += 1</span><br><span class="line"></span><br><span class="line">    hist += fast_hist(label.flatten(), net.blobs[layer].data[0].argmax(0).flatten(), n_cl)</span><br><span class="line"></span><br><span class="line">    if save_dir:</span><br><span class="line">        seg = net.blobs[layer].data[0].argmax(axis=0)</span><br><span class="line">        result = np.array(img, dtype=np.uint8)</span><br><span class="line">        index = np.where(seg == 1)</span><br><span class="line">        for i in xrange(len(index[0])):</span><br><span class="line">            result[index[0][i], index[1][i], 0] =  255</span><br><span class="line">            result[index[0][i], index[1][i], 1] =  0</span><br><span class="line">            result[index[0][i], index[1][i], 2] =  0</span><br><span class="line">        result = Image.fromarray(result.astype(np.uint8))    </span><br><span class="line">        result.save(os.path.join(save_dir, img_name + &apos;.jpg&apos;))        </span><br><span class="line"></span><br><span class="line">iter = len(test_img)</span><br><span class="line"># overall accuracy</span><br><span class="line">acc = np.diag(hist).sum() / hist.sum()</span><br><span class="line">print &apos;&gt;&gt;&gt;&apos;, datetime.now(), &apos;Iteration&apos;, iter, &apos;overall accuracy&apos;, acc</span><br><span class="line"># per-class accuracy</span><br><span class="line">acc = np.diag(hist) / hist.sum(1)</span><br><span class="line">print &apos;&gt;&gt;&gt;&apos;, datetime.now(), &apos;Iteration&apos;, iter, &apos;mean accuracy&apos;, np.nanmean(acc)</span><br><span class="line"># per-class IU</span><br><span class="line">iu = np.diag(hist) / (hist.sum(1) + hist.sum(0) - np.diag(hist))</span><br><span class="line">print &apos;&gt;&gt;&gt;&apos;, datetime.now(), &apos;Iteration&apos;, iter, &apos;mean IU&apos;, np.nanmean(iu)</span><br><span class="line">freq = hist.sum(1) / hist.sum()</span><br><span class="line">print &apos;&gt;&gt;&gt;&apos;, datetime.now(), &apos;Iteration&apos;, iter, &apos;fwavacc&apos;, \</span><br><span class="line">    (freq[freq &gt; 0] * iu[freq &gt; 0]).sum()</span><br></pre></td></tr></table></figure><h2 id="疑惑"><a href="#疑惑" class="headerlink" title="疑惑"></a>疑惑</h2><p>为何不适用MPA，而使用MIOU，两者在什么情况下有区别～</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://blog.csdn.net/u014593748/article/details/71698246" target="_blank" rel="noopener">论文笔记 |　基于深度学习的图像语义分割技术概述之5.1度量标准</a><br><a href="https://blog.csdn.net/qq_37274615/article/details/78957962" target="_blank" rel="noopener">图像分割的衡量指标详解</a><br><a href="https://github.com/martinkersner/py_img_seg_eval#frequency-weighted-iu" target="_blank" rel="noopener">Image Segmentation Evaluation</a><br><a href="https://lars76.github.io/neural-networks/object-detection/losses-for-segmentation/" target="_blank" rel="noopener">Losses for Image Segmentation</a></p></div><div><div style="text-align:center;color:#ccc;font-size:14px">------ 本文结束------</div></div><div class="reward-container"><div>坚持原创技术分享，您的支持将鼓励我继续创作！</div> <button onclick='var qr=document.getElementById("qr");qr.style.display="none"===qr.style.display?"block":"none"'> 打赏</button><div id="qr" style="display:none"><div style="display:inline-block"> <img src="/uploads/wechat.png" alt="zdaiot 微信支付"><p>微信支付</p></div><div style="display:inline-block"> <img src="/uploads/aipay.jpg" alt="zdaiot 支付宝"><p>支付宝</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> zdaiot</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.zdaiot.com/DeepLearningApplications/图像分割/图像分割评价指标/" title="图像分割评价指标">https://www.zdaiot.com/DeepLearningApplications/图像分割/图像分割评价指标/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="followme"><p>欢迎关注我的其它发布渠道</p><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="/uploads/wechat-qcode.jpg"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></a></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/图像分割/" rel="tag"><i class="fa fa-tag"></i> 图像分割</a><a href="/tags/评价指标/" rel="tag"><i class="fa fa-tag"></i> 评价指标</a></div><div class="post-nav"><div class="post-nav-item"><a href="/MLFrameworks/Pytorch/Pytorch损失函数总结/" rel="prev" title="Pytorch损失函数总结"><i class="fa fa-chevron-left"></i> Pytorch损失函数总结</a></div><div class="post-nav-item"> <a href="/Linux/博客搭建/网页部署到服务器以及浏览器预览PDF/" rel="next" title="网页部署到服务器以及浏览器预览PDF">网页部署到服务器以及浏览器预览PDF<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#基础知识"><span class="nav-number">1.</span> <span class="nav-text">基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#precesion"><span class="nav-number">1.1.</span> <span class="nav-text">precesion</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#recall"><span class="nav-number">1.2.</span> <span class="nav-text">recall</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PA"><span class="nav-number">2.</span> <span class="nav-text">PA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MPA"><span class="nav-number">3.</span> <span class="nav-text">MPA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MIoU"><span class="nav-number">4.</span> <span class="nav-text">MIoU</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FWIoU"><span class="nav-number">5.</span> <span class="nav-text">FWIoU</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DICE"><span class="nav-number">6.</span> <span class="nav-text">DICE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#代码"><span class="nav-number">7.</span> <span class="nav-text">代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#疑惑"><span class="nav-number">8.</span> <span class="nav-text">疑惑</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">9.</span> <span class="nav-text">参考</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="zdaiot" src="/uploads/avatar.png"><p class="site-author-name" itemprop="name">zdaiot</p><div class="site-description" itemprop="description">404NotFound</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">324</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">56</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">381</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/zdaiot" title="GitHub → https://github.com/zdaiot" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:zdaiot@163.com" title="E-Mail → mailto:zdaiot@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/" title="知乎 → https://www.zhihu.com/people/" rel="noopener" target="_blank"><i class="fa fa-book fa-fw"></i> 知乎</a></span><span class="links-of-author-item"><a href="https://blog.csdn.net/zdaiot" title="CSDN → https://blog.csdn.net/zdaiot" rel="noopener" target="_blank"><i class="fa fa-copyright fa-fw"></i> CSDN</a></span></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="link fa-fw"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="https://kalacloud.com" title="https://kalacloud.com" rel="noopener" target="_blank">卡拉云低代码工具</a></li></ul></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="https://beian.miit.gov.cn" rel="noopener" target="_blank">京ICP备2021031914号</a></div><div class="copyright"> &copy; <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">zdaiot</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-chart-area"></i></span> <span title="站点总字数">2.2m</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span title="站点阅读时长">34:04</span></div><div class="addthis_inline_share_toolbox"><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5b5e7e498f94b7ad" async="async"></script></div> <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>var now=new Date;function createtime(){var n=new Date("08/01/2018 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="Run for "+dnum+" Days ",document.getElementById("times").innerHTML=hnum+" Hours "+mnum+" m "+snum+" s"}setInterval("createtime()",250)</script><div class="busuanzi-count"><script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script><script data-pjax>!function(){var o,n,e=document.getElementsByTagName("link");if(0<e.length)for(i=0;i<e.length;i++)"canonical"==e[i].rel.toLowerCase()&&e[i].href&&(o=e[i].href);n=o?o.split(":")[0]:window.location.protocol.split(":")[0],o||(o=window.location.href),function(){var e=o,i=document.referrer;if(!/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(e)){var t="https"===String(n).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";i?(t+="?r="+encodeURIComponent(document.referrer),e&&(t+="&l="+e)):e&&(t+="?l="+e),(new Image).src=t}}(window)}()</script><script src="/js/local-search.js"></script><div id="pjax"><script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '4800250e682fe873198b',
      clientSecret: '80f7f33f5f8ddfd3944f455cabadda4ff3299147',
      repo        : 'zdaiot.github.io',
      owner       : 'zdaiot',
      admin       : ['zdaiot'],
      id          : '15d2e0d84cd3df229b6d47e4695ab7f6',
        language: '',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,log:!1,model:{jsonPath:"/live2dw/assets/wanko.model.json"},display:{position:"left",width:150,height:300},mobile:{show:!0}})</script></body></html>