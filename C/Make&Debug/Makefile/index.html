<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 3.9.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"www.zdaiot.com",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="1. Makefile 简介Makefile 是和 make 命令一起配合使用的. 很多大型项目的编译都是通过 Makefile 来组织的, 如果没有 Makefile, 那很多项目中各种库和代码之间的依赖关系不知会多复杂. Makefile的组织流程的能力如此之强, 不仅可以用来编译项目, 还可以用来组织我们平时的一些日常操作. 这个需要大家发挥自己的想象力. 本篇博客是基于 {精华} 跟我一起"><meta name="keywords" content="Makefile"><meta property="og:type" content="article"><meta property="og:title" content="Makefile"><meta property="og:url" content="https://www.zdaiot.com/C/Make&Debug/Makefile/index.html"><meta property="og:site_name" content="zdaiot"><meta property="og:description" content="1. Makefile 简介Makefile 是和 make 命令一起配合使用的. 很多大型项目的编译都是通过 Makefile 来组织的, 如果没有 Makefile, 那很多项目中各种库和代码之间的依赖关系不知会多复杂. Makefile的组织流程的能力如此之强, 不仅可以用来编译项目, 还可以用来组织我们平时的一些日常操作. 这个需要大家发挥自己的想象力. 本篇博客是基于 {精华} 跟我一起"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2019-09-15T04:20:33.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Makefile"><meta name="twitter:description" content="1. Makefile 简介Makefile 是和 make 命令一起配合使用的. 很多大型项目的编译都是通过 Makefile 来组织的, 如果没有 Makefile, 那很多项目中各种库和代码之间的依赖关系不知会多复杂. Makefile的组织流程的能力如此之强, 不仅可以用来编译项目, 还可以用来组织我们平时的一些日常操作. 这个需要大家发挥自己的想象力. 本篇博客是基于 {精华} 跟我一起"><link rel="canonical" href="https://www.zdaiot.com/C/Make&Debug/Makefile/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>Makefile | zdaiot</title><script data-pjax>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?0b0b58037319da4959d5a3c014160ccd";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">zdaiot</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">404NotFound</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.zdaiot.com/C/Make&Debug/Makefile/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/uploads/avatar.png"><meta itemprop="name" content="zdaiot"><meta itemprop="description" content="404NotFound"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="zdaiot"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Makefile<a href="https://github.com/zdaiot/zdaiot.github.io/tree/hexo/source/_posts/C/Make&Debug/Makefile.md" class="post-edit-link" title="编辑" rel="noopener" target="_blank"><i class="fa fa-pencil-alt"></i></a></h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-07-07 18:25:46" itemprop="dateCreated datePublished" datetime="2018-07-07T18:25:46+08:00">2018-07-07</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2019-09-15 12:20:33" itemprop="dateModified" datetime="2019-09-15T12:20:33+08:00">2019-09-15</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/C/Make-Debug/" itemprop="url" rel="index"><span itemprop="name">Make&Debug</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>20k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span>18 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="1-Makefile-简介"><a href="#1-Makefile-简介" class="headerlink" title="1. Makefile 简介"></a><strong>1. Makefile 简介</strong></h2><p>Makefile 是和 make 命令一起配合使用的.</p><p>很多大型项目的编译都是通过 Makefile 来组织的, 如果没有 Makefile, 那很多项目中各种库和代码之间的依赖关系不知会多复杂.</p><p>Makefile的组织流程的能力如此之强, 不仅可以用来编译项目, 还可以用来组织我们平时的一些日常操作. 这个需要大家发挥自己的想象力.</p><p>本篇博客是基于 <a href="http://bbs.chinaunix.net/forum.php?mod=viewthread&amp;tid=408225" target="_blank" rel="noopener">{精华} 跟我一起写 Makefile</a> 而整理的, 有些删减, 追加了一些示例.</p><p>非常感谢 gunguymadman_cu 提供如此详尽的Makefile介绍, 这正是我一直寻找的Makefile中文文档.</p><h3 id="1-1-Makefile-主要的-5个部分-显示规则-隐晦规则-变量定义-文件指示-注释"><a href="#1-1-Makefile-主要的-5个部分-显示规则-隐晦规则-变量定义-文件指示-注释" class="headerlink" title="1.1 Makefile 主要的 5个部分 (显示规则, 隐晦规则, 变量定义, 文件指示, 注释)"></a><strong>1.1 Makefile 主要的 5个部分 (显示规则, 隐晦规则, 变量定义, 文件指示, 注释)</strong></h3><p>Makefile基本格式如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">target ... : prerequisites ...</span><br><span class="line">    command</span><br><span class="line">    ...</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>其中,</p><ul><li>target - 目标文件, 可以是 Object File, 也可以是可执行文件</li><li>prerequisites - 生成 target 所需要的文件或者目标</li><li>command - make需要执行的命令 (任意的shell命令), Makefile中的命令必须以 [tab] 开头</li></ul><ol><li><strong>显示规则 :: 说明如何生成一个或多个目标文件(包括 生成的文件, 文件的依赖文件, 生成的命令)</strong></li><li><strong>隐晦规则 :: make的自动推导功能所执行的规则</strong></li><li><strong>变量定义 :: Makefile中定义的变量</strong></li><li><strong>文件指示 :: Makefile中引用其他Makefile; 指定Makefile中有效部分; 定义一个多行命令</strong></li><li><strong>注释 :: Makefile只有行注释 “#”, 如果要使用或者输出”#”字符, 需要进行转义, “\#“</strong></li></ol><h3 id="1-2-GNU-make-的工作方式"><a href="#1-2-GNU-make-的工作方式" class="headerlink" title="1.2 GNU make 的工作方式"></a><strong>1.2 GNU make 的工作方式</strong></h3><ol><li>读入主Makefile (主Makefile中可以引用其他Makefile)</li><li>读入被include的其他Makefile</li><li>初始化文件中的变量</li><li>推导隐晦规则, 并分析所有规则</li><li>为所有的目标文件创建依赖关系链</li><li>根据依赖关系, 决定哪些目标要重新生成</li><li>执行生成命令</li></ol><h2 id="2-Makefile-初级语法"><a href="#2-Makefile-初级语法" class="headerlink" title="2. Makefile 初级语法"></a><strong>2. Makefile 初级语法</strong></h2><h3 id="2-1-Makefile-规则"><a href="#2-1-Makefile-规则" class="headerlink" title="2.1 Makefile 规则"></a><strong>2.1 Makefile 规则</strong></h3><h4 id="2-1-1-规则语法"><a href="#2-1-1-规则语法" class="headerlink" title="2.1.1 规则语法"></a><strong>2.1.1 规则语法</strong></h4><p>规则主要有2部分: 依赖关系 和 生成目标的方法.</p><p>语法有以下2种:<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">target ... : prerequisites ...</span><br><span class="line">    command</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p></p><p>或者</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">target ... : prerequisites ; command</span><br><span class="line">    command</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p><strong>注</strong> command太长, 可以用 “\” 作为换行符</p><h4 id="2-1-2-规则中的通配符"><a href="#2-1-2-规则中的通配符" class="headerlink" title="2.1.2 规则中的通配符"></a><strong>2.1.2 规则中的通配符</strong></h4><ul><li>* :: 表示任意一个或多个字符</li><li>? :: 表示任意一个字符</li><li>[…] :: ex. [abcd] 表示a,b,c,d中任意一个字符, <sup><a href="#fn_abcd" id="reffn_abcd">abcd</a></sup>表示除a,b,c,d以外的字符, [0-9]表示 0~9中任意一个数字</li><li>~ :: 表示用户的home目录</li></ul><h4 id="2-1-3-路径搜索"><a href="#2-1-3-路径搜索" class="headerlink" title="2.1.3 路径搜索"></a><strong>2.1.3 路径搜索</strong></h4><p>当一个Makefile中涉及到大量源文件时(这些源文件和Makefile极有可能不在同一个目录中),</p><p>这时, 最好将源文件的路径明确在Makefile中, 便于编译时查找. Makefile中有个特殊的变量 <strong>VPATH</strong> 就是完成这个功能的.</p><p>指定了 <strong>VPATH</strong> 之后, 如果当前目录中没有找到相应文件或依赖的文件, Makefile 回到 <strong>VPATH</strong> 指定的路径中再去查找..</p><p><strong>VPATH</strong> 使用方法:</p><ul><li>vpath &lt;directories&gt; :: 当前目录中找不到文件时, 就从&lt;directories&gt;中搜索</li><li>vpath &lt;pattern&gt; &lt;directories&gt; :: 符合&lt;pattern&gt;格式的文件, 就从&lt;directories&gt;中搜索</li><li>vpath &lt;pattern&gt; :: 清除符合&lt;pattern&gt;格式的文件搜索路径</li><li>vpath :: 清除所有已经设置好的文件路径</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 示例1 - 当前目录中找不到文件时, 按顺序从 src目录 ../parent-dir目录中查找文件</span><br><span class="line">VPATH src:../parent-dir </span><br><span class="line"></span><br><span class="line"># 示例2 - .h结尾的文件都从 ./header 目录中查找</span><br><span class="line">VPATH %.h ./header</span><br><span class="line"></span><br><span class="line"># 示例3 - 清除示例2中设置的规则</span><br><span class="line">VPATH %.h</span><br><span class="line"></span><br><span class="line"># 示例4 - 清除所有VPATH的设置</span><br><span class="line">VPATH</span><br></pre></td></tr></table></figure><h3 id="2-2-Makefile-中的变量"><a href="#2-2-Makefile-中的变量" class="headerlink" title="2.2 Makefile 中的变量"></a><strong>2.2 Makefile 中的变量</strong></h3><h4 id="2-2-1-变量定义-or"><a href="#2-2-1-变量定义-or" class="headerlink" title="2.2.1 变量定义 ( = or := )"></a><strong>2.2.1 变量定义 ( = or := )</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">OBJS = programA.o programB.o</span><br><span class="line">OBJS-ADD = $(OBJS) programC.o</span><br><span class="line"># 或者</span><br><span class="line">OBJS := programA.o programB.o</span><br><span class="line">OBJS-ADD := $(OBJS) programC.o</span><br></pre></td></tr></table></figure><p>其中 = 和 := 的区别在于, := 只能使用前面定义好的变量, = 可以使用后面定义的变量</p><p><strong>测试 =</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Makefile内容</span><br><span class="line">OBJS2 = $(OBJS1) programC.o</span><br><span class="line">OBJS1 = programA.o programB.o</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo $(OBJS2)</span><br><span class="line"></span><br><span class="line"># bash中执行 make, 可以看出虽然 OBJS1 是在 OBJS2 之后定义的, 但在 OBJS2中可以提前使用</span><br><span class="line">$ make </span><br><span class="line">programA.o programB.o programC.o</span><br></pre></td></tr></table></figure><p></p><p><strong>测试 :=</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Makefile内容</span><br><span class="line">OBJS2 := $(OBJS1) programC.o</span><br><span class="line">OBJS1 := programA.o programB.o</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo $(OBJS2)</span><br><span class="line"></span><br><span class="line"># bash中执行 make, 可以看出 OBJS2 中的 $(OBJS1) 为空</span><br><span class="line">$ make </span><br><span class="line">programC.o</span><br></pre></td></tr></table></figure><p></p><h4 id="2-2-2-变量替换"><a href="#2-2-2-变量替换" class="headerlink" title="2.2.2 变量替换"></a><strong>2.2.2 变量替换</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Makefile内容</span><br><span class="line">SRCS := programA.c programB.c programC.c</span><br><span class="line">OBJS := $(SRCS:%.c=%.o)</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo &quot;SRCS: &quot; $(SRCS)</span><br><span class="line">    @echo &quot;OBJS: &quot; $(OBJS)</span><br><span class="line"></span><br><span class="line"># bash中运行make</span><br><span class="line">$ make </span><br><span class="line">SRCS:  programA.c programB.c programC.c</span><br><span class="line">OBJS:  programA.o programB.o programC.o</span><br></pre></td></tr></table></figure><h4 id="2-2-3-变量追加值"><a href="#2-2-3-变量追加值" class="headerlink" title="2.2.3 变量追加值 +="></a><strong>2.2.3 变量追加值 +=</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Makefile内容</span><br><span class="line">SRCS := programA.c programB.c programC.c</span><br><span class="line">SRCS += programD.c</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo &quot;SRCS: &quot; $(SRCS)</span><br><span class="line"></span><br><span class="line"># bash中运行make</span><br><span class="line">$ make </span><br><span class="line">SRCS:  programA.c programB.c programC.c programD.c</span><br></pre></td></tr></table></figure><h4 id="2-2-4-变量覆盖-override"><a href="#2-2-4-变量覆盖-override" class="headerlink" title="2.2.4 变量覆盖 override"></a><strong>2.2.4 变量覆盖 override</strong></h4><p>作用是使 Makefile中定义的变量能够覆盖 make 命令参数中指定的变量</p><p>语法:</p><ul><li>override &lt;variable&gt; = &lt;value&gt;</li><li>override &lt;variable&gt; := &lt;value&gt;</li><li>override &lt;variable&gt; += &lt;value&gt;</li></ul><p>下面通过一个例子体会 override 的作用：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># Makefile内容 (没有用override)</span><br><span class="line">SRCS := programA.c programB.c programC.c</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo &quot;SRCS: &quot; $(SRCS)</span><br><span class="line"></span><br><span class="line"># bash中运行make</span><br><span class="line">$ make SRCS=nothing</span><br><span class="line">SRCS:  nothing</span><br><span class="line"></span><br><span class="line">#################################################</span><br><span class="line"></span><br><span class="line"># Makefile内容 (用override)</span><br><span class="line">override SRCS := programA.c programB.c programC.c</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo &quot;SRCS: &quot; $(SRCS)</span><br><span class="line"></span><br><span class="line"># bash中运行make</span><br><span class="line">$ make SRCS=nothing</span><br><span class="line">SRCS:  programA.c programB.c programC.c</span><br></pre></td></tr></table></figure><p></p><h4 id="2-2-5-目标变量"><a href="#2-2-5-目标变量" class="headerlink" title="2.2.5 目标变量"></a><strong>2.2.5 目标变量</strong></h4><p>作用是使变量的作用域仅限于这个目标(target), 而不像之前例子中定义的变量, 对整个Makefile都有效.</p><p>语法:</p><ul><li>&lt;target …&gt; :: &lt;variable-assignment&gt;</li><li>&lt;target …&gt; :: override &lt;variable-assignment&gt; (override作用参见 变量覆盖的介绍)</li></ul><p>示例:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">SRCS := programA.c programB.c programC.c</span><br><span class="line"></span><br><span class="line">target1: TARGET1-SRCS := programD.c</span><br><span class="line">target1:</span><br><span class="line">    @echo &quot;SRCS: &quot; $(SRCS)</span><br><span class="line">    @echo &quot;SRCS: &quot; $(TARGET1-SRCS)</span><br><span class="line"></span><br><span class="line">target2:</span><br><span class="line">    @echo &quot;SRCS: &quot; $(SRCS)</span><br><span class="line">    @echo &quot;SRCS: &quot; $(TARGET1-SRCS)</span><br><span class="line"></span><br><span class="line"># bash中执行make</span><br><span class="line">$ make target1</span><br><span class="line">SRCS:  programA.c programB.c programC.c</span><br><span class="line">SRCS:  programD.c</span><br><span class="line"></span><br><span class="line">$ make target2     &lt;-- target2中显示不了 $(TARGET1-SRCS)</span><br><span class="line">SRCS:  programA.c programB.c programC.c</span><br><span class="line">SRCS:</span><br></pre></td></tr></table></figure><h3 id="2-3-Makefile-命令前缀"><a href="#2-3-Makefile-命令前缀" class="headerlink" title="2.3 Makefile 命令前缀"></a><strong>2.3 Makefile 命令前缀</strong></h3><p>Makefile 中书写shell命令时可以加2种前缀 @ 和 -, 或者不用前缀.</p><p>3种格式的shell命令区别如下:</p><ul><li>不用前缀 :: 输出执行的命令以及命令执行的结果, 出错的话停止执行</li><li>前缀 @ :: 只输出命令执行的结果, 出错的话停止执行</li><li>前缀 - :: 命令执行有错的话, 忽略错误, 继续执行</li></ul><p>示例:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容 (不用前缀)</span><br><span class="line">all: echo &quot;没有前缀&quot;</span><br><span class="line">    cat this_file_not_exist </span><br><span class="line">    echo &quot;错误之后的命令&quot;       &lt;-- 这条命令不会被执行</span><br><span class="line"></span><br><span class="line"># bash中执行 make </span><br><span class="line">$ make</span><br><span class="line">echo &quot;没有前缀&quot;             &lt;-- 命令本身显示出来</span><br><span class="line">没有前缀                    &lt;-- 命令执行结果显示出来 </span><br><span class="line">cat this_file_not_exist </span><br><span class="line">cat: this_file_not_exist: No such file or directory </span><br><span class="line">make: *** [all] Error 1 </span><br><span class="line"></span><br><span class="line">###########################################################</span><br><span class="line"></span><br><span class="line"># Makefile 内容 (前缀 @)</span><br><span class="line">all:</span><br><span class="line">    @echo &quot;没有前缀&quot; </span><br><span class="line">    @cat this_file_not_exist</span><br><span class="line">    @echo &quot;错误之后的命令&quot;       &lt;-- 这条命令不会被执行</span><br><span class="line"></span><br><span class="line"># bash中执行 make </span><br><span class="line">$ make </span><br><span class="line">没有前缀 &lt;-- 只有命令执行的结果, 不显示命令本身 </span><br><span class="line">cat: this_file_not_exist: No such file or directory </span><br><span class="line">make: *** [all] Error 1 </span><br><span class="line"></span><br><span class="line">###########################################################</span><br><span class="line"></span><br><span class="line"># Makefile 内容 (前缀 -)</span><br><span class="line">all: -echo &quot;没有前缀&quot;</span><br><span class="line">     -cat this_file_not_exist </span><br><span class="line">     -echo &quot;错误之后的命令&quot;       &lt;-- 这条命令会被执行</span><br><span class="line"></span><br><span class="line"># bash中执行 make </span><br><span class="line">$ make</span><br><span class="line">echo &quot;没有前缀&quot;             &lt;-- 命令本身显示出来</span><br><span class="line">没有前缀 &lt;-- 命令执行结果显示出来 </span><br><span class="line">cat this_file_not_exist </span><br><span class="line">cat: this_file_not_exist: No such file or directory </span><br><span class="line">make: [all] Error 1 (ignored) </span><br><span class="line">echo &quot;错误之后的命令&quot;       &lt;-- 出错之后的命令也会显示</span><br><span class="line">错误之后的命令 &lt;-- 出错之后的命令也会执行</span><br></pre></td></tr></table></figure><h3 id="2-4-伪目标"><a href="#2-4-伪目标" class="headerlink" title="2.4 伪目标"></a><strong>2.4 伪目标</strong></h3><p>伪目标并不是一个”目标(target)”, 不像真正的目标那样会生成一个目标文件.</p><p>典型的伪目标是 Makefile 中用来清理编译过程中中间文件的 clean 伪目标, 一般格式如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.PHONY: clean   &lt;-- 这句没有也行, 但是最好加上</span><br><span class="line">clean:</span><br><span class="line">-rm -f *.o</span><br></pre></td></tr></table></figure><h3 id="2-5-引用其他的-Makefile"><a href="#2-5-引用其他的-Makefile" class="headerlink" title="2.5 引用其他的 Makefile"></a><strong>2.5 引用其他的 Makefile</strong></h3><p>语法: include &lt;filename&gt; (filename 可以包含通配符和路径)</p><p>示例:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo &quot;主 Makefile begin&quot; </span><br><span class="line">    @make other-all</span><br><span class="line">    @echo &quot;主 Makefile end&quot; </span><br><span class="line">    </span><br><span class="line">include ./other/Makefile</span><br><span class="line"></span><br><span class="line"># ./other/Makefile 内容</span><br><span class="line">other-all:</span><br><span class="line">    @echo &quot;other makefile begin&quot; </span><br><span class="line">    @echo &quot;other makefile end&quot; </span><br><span class="line">    </span><br><span class="line"># bash中执行 make </span><br><span class="line">$ ll</span><br><span class="line">total 20K </span><br><span class="line">-rw-r--r-- 1 wangyubin wangyubin  125 Sep 23 16:13 Makefile </span><br><span class="line">-rw-r--r-- 1 wangyubin wangyubin  11K Sep 23 16:15 makefile.org   &lt;-- 这个文件不用管</span><br><span class="line">drwxr-xr-x 2 wangyubin wangyubin 4.0K Sep 23 16:11 other</span><br><span class="line">$ ll other/ </span><br><span class="line">total 4.0K </span><br><span class="line">-rw-r--r-- 1 wangyubin wangyubin 71 Sep 23 16:11 Makefile</span><br><span class="line"></span><br><span class="line">$ make </span><br><span class="line">主 Makefile begin </span><br><span class="line">make[1]: Entering directory `/path/to/test/makefile&apos;</span><br><span class="line">other makefile begin</span><br><span class="line">other makefile end </span><br><span class="line">make[1]: Leaving directory `/path/to/test/makefile&apos;</span><br><span class="line">主 Makefile end</span><br></pre></td></tr></table></figure><h3 id="2-6-查看C文件的依赖关系"><a href="#2-6-查看C文件的依赖关系" class="headerlink" title="2.6 查看C文件的依赖关系"></a><strong>2.6 查看C文件的依赖关系</strong></h3><p>写 Makefile 的时候, 需要确定每个目标的依赖关系.</p><p>GNU提供一个机制可以查看C代码文件依赖那些文件, 这样我们在写 Makefile 目标的时候就不用打开C源码来看其依赖那些文件了.</p><p>比如, 下面命令显示内核源码中 virt/kvm/kvm_main.c 中的依赖关系</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cd virt/kvm/ </span><br><span class="line">$ gcc -MM kvm_main.c </span><br><span class="line">kvm_main.o: kvm_main.c iodev.h coalesced_mmio.h async_pf.h &lt;-- 这句就可以加到 Makefile 中作为编译 kvm_main.o 的依赖关系</span><br></pre></td></tr></table></figure><h3 id="2-7-make-退出码"><a href="#2-7-make-退出码" class="headerlink" title="2.7 make 退出码"></a><strong>2.7 make 退出码</strong></h3><p>Makefile的退出码有以下3种：</p><ul><li>0 :: 表示成功执行</li><li>1 :: 表示make命令出现了错误</li><li>2 :: 使用了 “-q” 选项, 并且make使得一些目标不需要更新</li></ul><h3 id="2-8-指定-Makefile，-指定特定目标"><a href="#2-8-指定-Makefile，-指定特定目标" class="headerlink" title="2.8 指定 Makefile， 指定特定目标"></a><strong>2.8 指定 Makefile， 指定特定目标</strong></h3><p><strong>默认执行 make 命令时, GNU make在当前目录下依次搜索下面3个文件 “GNUmakefile”, “makefile”, “Makefile”,</strong></p><p>找到对应文件之后, 就开始执行此文件中的第一个目标(target). 如果找不到这3个文件就报错.</p><p>非默认情况下, 可以在 make 命令中指定特定的 Makefile 和特定的 目标.</p><p>示例：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Makefile文件名改为 MyMake, 内容</span></span><br><span class="line">target1:</span><br><span class="line">    @<span class="built_in">echo</span> <span class="string">"target [1]  begin"</span> </span><br><span class="line">    @<span class="built_in">echo</span> <span class="string">"target [1]  end"</span> </span><br><span class="line">    </span><br><span class="line">target2:</span><br><span class="line">    @<span class="built_in">echo</span> <span class="string">"target [2]  begin"</span> </span><br><span class="line">    @<span class="built_in">echo</span> <span class="string">"target [2]  end"</span> </span><br><span class="line">    </span><br><span class="line"><span class="comment"># bash 中执行 make </span></span><br><span class="line">$ ls </span><br><span class="line">Makefile</span><br><span class="line">$ mv Makefile MyMake</span><br><span class="line">$ ls </span><br><span class="line">MyMake</span><br><span class="line">$ make                     &lt;-- 找不到默认的 Makefile make: *** No targets specified and no makefile found.  Stop.</span><br><span class="line">$ make -f MyMake           &lt;-- 指定特定的Makefile</span><br><span class="line">target [1]  begin</span><br><span class="line">target [1]  end</span><br><span class="line">$ make -f MyMake target2   &lt;-- 指定特定的目标(target)</span><br><span class="line">target [2]  begin</span><br><span class="line">target [2]  end</span><br></pre></td></tr></table></figure><p></p><h3 id="2-9-make-参数介绍"><a href="#2-9-make-参数介绍" class="headerlink" title="2.9 make 参数介绍"></a><strong>2.9 make 参数介绍</strong></h3><p>make 的参数有很多, 可以通过 make -h 去查看, 下面只介绍几个我认为比较有用的.</p><p>|<strong>参数</strong>|<strong>含义</strong>|<br>||—|<br>| —debug[=&lt;options&gt;] | 输出make的调试信息,options 可以是 a, b, v |<br>| -j —jobs | 同时运行的命令的个数, 也就是多线程执行 Makefile |<br>| -r —no-builtin-rules | 禁止使用任何隐含规则 |<br>| -R —no-builtin-variabes | 禁止使用任何作用于变量上的隐含规则 |<br>| -B —always-make | 假设所有目标都有更新, 即强制重编译 |</p><h3 id="2-10-Makefile-隐含规则"><a href="#2-10-Makefile-隐含规则" class="headerlink" title="2.10 Makefile 隐含规则"></a><strong>2.10 Makefile 隐含规则</strong></h3><p>这里只列一个和编译C相关的.</p><p>编译C时，&lt;n&gt;.o 的目标会自动推导为 &lt;n&gt;.c</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 中</span><br><span class="line">main : main.o </span><br><span class="line">    gcc -o main main.o</span><br><span class="line"></span><br><span class="line">#会自动变为:</span><br><span class="line">main : main.o </span><br><span class="line">    gcc -o main main.o</span><br><span class="line"></span><br><span class="line">main.o: main.c &lt;-- main.o 这个目标是隐含生成的 </span><br><span class="line">    gcc -c main.c</span><br></pre></td></tr></table></figure><h3 id="2-11-隐含规则中的-命令变量-和-命令参数变量"><a href="#2-11-隐含规则中的-命令变量-和-命令参数变量" class="headerlink" title="2.11 隐含规则中的 命令变量 和 命令参数变量"></a><strong>2.11 隐含规则中的 命令变量 和 命令参数变量</strong></h3><h4 id="2-11-1-命令变量-书写Makefile可以直接写-shell时用这些变量"><a href="#2-11-1-命令变量-书写Makefile可以直接写-shell时用这些变量" class="headerlink" title="2.11.1 命令变量, 书写Makefile可以直接写 shell时用这些变量."></a><strong>2.11.1 命令变量, 书写Makefile可以直接写 shell时用这些变量.</strong></h4><p>下面只列出一些C相关的</p><p>|<strong>变量名</strong>| <strong>含义</strong>|<br>||—|<br>| RM | rm -f |<br>| AR | ar |<br>| CC | cc |<br>| CXX | g++ |</p><p>示例:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(RM)</span><br><span class="line">    @echo $(AR)</span><br><span class="line">    @echo $(CC)</span><br><span class="line">    @echo $(CXX)</span><br><span class="line"></span><br><span class="line"># bash 中执行make, 显示各个变量的值</span><br><span class="line">$ make</span><br><span class="line">rm -f </span><br><span class="line">ar</span><br><span class="line">cc </span><br><span class="line">g++</span><br></pre></td></tr></table></figure><h4 id="2-11-2-命令参数变量"><a href="#2-11-2-命令参数变量" class="headerlink" title="2.11.2 命令参数变量"></a><strong>2.11.2 命令参数变量</strong></h4><p>|<strong>变量名</strong>|<strong>含义</strong>|<br>||—|<br>| ARFLAGS | AR命令的参数 |<br>| CFLAGS | C语言编译器的参数 |<br>| CXXFLAGS | C++语言编译器的参数 |</p><p>示例: 下面以 CFLAGS 为例演示<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># test.c 内容</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    printf (&quot;Hello Makefile\n&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Makefile 内容</span><br><span class="line">test: test.o</span><br><span class="line">    $(CC) -o test test.o</span><br><span class="line"></span><br><span class="line"># bash 中用 make 来测试</span><br><span class="line">$ ll</span><br><span class="line">total 24K</span><br><span class="line">-rw-r--r-- 1 wangyubin wangyubin  69 Sep 23 17:31 Makefile</span><br><span class="line">-rw-r--r-- 1 wangyubin wangyubin 14K Sep 23 19:51 makefile.org   &lt;-- 请忽略这个文件</span><br><span class="line">-rw-r--r-- 1 wangyubin wangyubin 392 Sep 23 17:31 test.c</span><br><span class="line"></span><br><span class="line">$ make</span><br><span class="line">cc    -c -o test.o test.c</span><br><span class="line">cc -o test test.o               &lt;-- 这个是自动推导的</span><br><span class="line"></span><br><span class="line">$ rm -f test test.o</span><br><span class="line"></span><br><span class="line">$ make CFLAGS=-Wall             &lt;-- 命令中加的编译器参数自动追加入下面的编译中了</span><br><span class="line">cc -Wall   -c -o test.o test.c</span><br><span class="line">cc -o test test.o</span><br></pre></td></tr></table></figure><p></p><h3 id="2-12-自动变量"><a href="#2-12-自动变量" class="headerlink" title="2.12 自动变量"></a><strong>2.12 自动变量</strong></h3><p>Makefile 中很多时候通过自动变量来简化书写, 各个自动变量的含义如下:</p><p>|<strong>自动变量</strong>|<strong>含义</strong>|<br>||—|<br>| $@ | 目标集合 |<br>| $% | 当目标是函数库文件时, 表示其中的目标文件名 |<br>| $&lt; | 第一个依赖目标. 如果依赖目标是多个, 逐个表示依赖目标 |<br>| $? | 比目标新的依赖目标的集合 |<br>| $^ | 所有依赖目标的集合, 会去除重复的依赖目标 |<br>| $+ | 所有依赖目标的集合, 不会去除重复的依赖目标 |<br>| $* | 这个是GNU make特有的, 其它的make不一定支持 |</p><h2 id="3-Makefile-高级语法"><a href="#3-Makefile-高级语法" class="headerlink" title="3. Makefile 高级语法"></a><strong>3. Makefile 高级语法</strong></h2><h3 id="3-1-嵌套Makefile"><a href="#3-1-嵌套Makefile" class="headerlink" title="3.1 嵌套Makefile"></a><strong>3.1 嵌套Makefile</strong></h3><p>在 Makefile 初级语法中已经提到过引用其它 Makefile的方法. 这里有另一种写法, 并且可以向引用的其它 Makefile 传递参数.</p><p>示例: (不传递参数, 只是调用子文件夹 other 中的Makefile)<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo &quot;主 Makefile begin&quot;</span><br><span class="line">    @cd ./other &amp;&amp; make</span><br><span class="line">    @echo &quot;主 Makefile end&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ./other/Makefile 内容</span><br><span class="line">other-all:</span><br><span class="line">    @echo &quot;other makefile begin&quot;</span><br><span class="line">    @echo &quot;other makefile end&quot;</span><br><span class="line"></span><br><span class="line"># bash中执行 make</span><br><span class="line">$ ll</span><br><span class="line">total 28K</span><br><span class="line">-rw-r--r-- 1 wangyubin wangyubin  104 Sep 23 20:43 Makefile</span><br><span class="line">-rw-r--r-- 1 wangyubin wangyubin  17K Sep 23 20:44 makefile.org   &lt;-- 这个文件不用管</span><br><span class="line">drwxr-xr-x 2 wangyubin wangyubin 4.0K Sep 23 20:42 other</span><br><span class="line">$ ll other/</span><br><span class="line">total 4.0K</span><br><span class="line">-rw-r--r-- 1 wangyubin wangyubin 71 Sep 23 16:11 Makefile</span><br><span class="line"></span><br><span class="line">$ make</span><br><span class="line">主 Makefile begin</span><br><span class="line">make[1]: Entering directory `/path/to/test/makefile/other&apos;</span><br><span class="line">other makefile begin</span><br><span class="line">other makefile end</span><br><span class="line">make[1]: Leaving directory `/path/to/test/makefile/other&apos;</span><br><span class="line">主 Makefile end</span><br></pre></td></tr></table></figure><p></p><p>示例: (用export传递参数)<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">export VALUE1 := export.c    &lt;-- 用了 export, 此变量能够传递到 ./other/Makefile 中</span><br><span class="line">VALUE2 := no-export.c        &lt;-- 此变量不能传递到 ./other/Makefile 中</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo &quot;主 Makefile begin&quot;</span><br><span class="line">    @cd ./other &amp;&amp; make</span><br><span class="line">    @echo &quot;主 Makefile end&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ./other/Makefile 内容</span><br><span class="line">other-all:</span><br><span class="line">    @echo &quot;other makefile begin&quot;</span><br><span class="line">    @echo &quot;VALUE1: &quot; $(VALUE1)</span><br><span class="line">    @echo &quot;VALUE2: &quot; $(VALUE2)</span><br><span class="line">    @echo &quot;other makefile end&quot;</span><br><span class="line"></span><br><span class="line"># bash中执行 make</span><br><span class="line">$ make</span><br><span class="line">主 Makefile begin</span><br><span class="line">make[1]: Entering directory `/path/to/test/makefile/other&apos;</span><br><span class="line">other makefile begin</span><br><span class="line">VALUE1:  export.c        &lt;-- VALUE1 传递成功</span><br><span class="line">VALUE2:                  &lt;-- VALUE2 传递失败</span><br><span class="line">other makefile end</span><br><span class="line">make[1]: Leaving directory `/path/to/test/makefile/other&apos;</span><br><span class="line">主 Makefile end</span><br></pre></td></tr></table></figure><p></p><p><strong>补充</strong> export 语法格式如下:</p><ul><li>export variable = value</li><li>export variable := value</li><li>export variable += value</li></ul><h3 id="3-2-定义命令包"><a href="#3-2-定义命令包" class="headerlink" title="3.2 定义命令包"></a><strong>3.2 定义命令包</strong></h3><p>命令包有点像是个函数, 将连续的相同的命令合成一条, 减少 Makefile 中的代码量, 便于以后维护.</p><p><strong>语法:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">define &amp;lt;command-name&gt; </span><br><span class="line">command</span><br><span class="line">..</span><br><span class="line">endef</span><br></pre></td></tr></table></figure><p><strong>示例:</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">define run-hello-makefile</span><br><span class="line">@echo -n &quot;Hello&quot;</span><br><span class="line">@echo &quot; Makefile!&quot;</span><br><span class="line">@echo &quot;这里可以执行多条 Shell 命令!&quot;</span><br><span class="line">endef</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    $(run-hello-makefile)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># bash 中运行make</span><br><span class="line">$ make</span><br><span class="line">Hello Makefile!</span><br><span class="line">这里可以执行多条 Shell 命令!</span><br></pre></td></tr></table></figure><p></p><h3 id="3-3-条件判断"><a href="#3-3-条件判断" class="headerlink" title="3.3 条件判断"></a><strong>3.3 条件判断</strong></h3><p>条件判断的关键字主要有 <strong>ifeq ifneq ifdef ifndef</strong></p><p><strong>语法:</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;conditional-directive&gt;</span><br><span class="line">&lt;text-if-true&gt;</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line"># 或者</span><br><span class="line">&lt;conditional-directive&gt;</span><br><span class="line">&lt;text-if-true&gt;</span><br><span class="line">else</span><br><span class="line">&lt;text-if-false&gt;</span><br><span class="line">endif</span><br></pre></td></tr></table></figure><p></p><p><strong>示例:</strong> ifeq的例子, ifneq和ifeq的使用方法类似, 就是取反<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">ifeq (&quot;aa&quot;, &quot;bb&quot;)</span><br><span class="line">    @echo &quot;equal&quot;</span><br><span class="line">else</span><br><span class="line">    @echo &quot;not equal&quot;</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">not equal</span><br></pre></td></tr></table></figure><p></p><p><strong>示例:</strong> ifdef的例子, ifndef和ifdef的使用方法类似, 就是取反<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">SRCS := program.c</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">ifdef SRCS</span><br><span class="line">    @echo $(SRCS)</span><br><span class="line">else</span><br><span class="line">    @echo &quot;no SRCS&quot;</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">program.c</span><br></pre></td></tr></table></figure><p></p><h3 id="3-4-Makefile-中的函数"><a href="#3-4-Makefile-中的函数" class="headerlink" title="3.4 Makefile 中的函数"></a><strong>3.4 Makefile 中的函数</strong></h3><p>Makefile 中自带了一些函数, 利用这些函数可以简化 Makefile 的编写.</p><p>函数调用语法如下:<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(&lt;function&gt; &lt;arguments&gt;)</span><br><span class="line"># 或者</span><br><span class="line">$&#123;&lt;function&gt; &lt;arguments&gt;&#125;</span><br></pre></td></tr></table></figure><p></p><ul><li>&lt;function&gt; 是函数名</li><li>&lt;arguments&gt; 是函数参数</li></ul><h4 id="3-4-1-字符串函数"><a href="#3-4-1-字符串函数" class="headerlink" title="3.4.1 字符串函数"></a><strong>3.4.1 字符串函数</strong></h4><p><strong>字符串替换函数: $(subst &lt;from&gt;,&lt;to&gt;,&lt;text&gt;)</strong></p><p>功能: 把字符串&lt;text&gt; 中的 &lt;from&gt; 替换为 &lt;to&gt;</p><p>返回: 替换过的字符串<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(subst t,e,maktfilt)  &lt;-- 将t替换为e</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">makefile</span><br></pre></td></tr></table></figure><p></p><p><strong>模式字符串替换函数: $(patsubst &lt;pattern&gt;,&lt;replacement&gt;,&lt;text&gt;)</strong></p><p>功能: 查找<text>中的单词(单词以”空格”, “tab”, “换行”来分割) 是否符合 &lt;pattern&gt;, 符合的话, 用 &lt;replacement&gt; 替代.</text></p><p>返回: 替换过的字符串<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(patsubst %.c,%.o,programA.c programB.c)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">programA.o programB.o</span><br></pre></td></tr></table></figure><p></p><p><strong>去空格函数: $(strip &lt;string&gt;)</strong></p><p>功能: 去掉 &lt;string&gt; 字符串中开头和结尾的空字符</p><p>返回: 被去掉空格的字符串值<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">VAL := &quot;       aa  bb  cc &quot;</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo &quot;去除空格前: &quot; $(VAL)</span><br><span class="line">    @echo &quot;去除空格后: &quot; $(strip $(VAL))</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">去除空格前:         aa  bb  cc </span><br><span class="line">去除空格后:   aa bb cc</span><br></pre></td></tr></table></figure><p></p><p><strong>查找字符串函数: $(findstring &lt;find&gt;,&lt;in&gt;)</strong></p><p>功能: 在字符串 &lt;in&gt; 中查找 &lt;find&gt; 字符串</p><p>返回: 如果找到, 返回 &lt;find&gt; 字符串, 否则返回空字符串<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">VAL := &quot;       aa  bb  cc &quot;</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo $(findstring aa,$(VAL))</span><br><span class="line">    @echo $(findstring ab,$(VAL))</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">aa</span><br></pre></td></tr></table></figure><p></p><p><strong>过滤函数: $(filter &lt;pattern…&gt;,&lt;text&gt;)</strong></p><p>功能: 以 &lt;pattern&gt; 模式过滤字符串 &lt;text&gt;, <em>保留</em> 符合模式 &lt;pattern&gt; 的单词, 可以有多个模式</p><p>返回: 符合模式 &lt;pattern&gt; 的字符串<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(filter %.o %.a,program.c program.o program.a)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">program.o program.a</span><br></pre></td></tr></table></figure><p></p><p><strong>反过滤函数: $(filter-out &lt;pattern…&gt;,&lt;text&gt;)</strong></p><p>功能: 以 &lt;pattern&gt; 模式过滤字符串 &lt;text&gt;, <em>去除</em> 符合模式 &lt;pattern&gt; 的单词, 可以有多个模式</p><p>返回: 不符合模式 &lt;pattern&gt; 的字符串<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(filter-out %.o %.a,program.c program.o program.a)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">program.c</span><br></pre></td></tr></table></figure><p></p><p><strong>排序函数: $(sort &lt;list&gt;)</strong></p><p>功能: 给字符串 &lt;list&gt; 中的单词排序 (升序)</p><p>返回: 排序后的字符串<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(sort bac abc acb cab)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">abc acb bac cab</span><br></pre></td></tr></table></figure><p></p><p><strong>取单词函数: $(word &lt;n&gt;,&lt;text&gt;)</strong></p><p>功能: 取字符串 &lt;text&gt; 中的 第&lt;n&gt;个单词 (n从1开始)</p><p>返回: &lt;text&gt; 中的第&lt;n&gt;个单词, 如果&lt;n&gt; 比 &lt;text&gt; 中单词个数要大, 则返回空字符串<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(word 1,aa bb cc dd)</span><br><span class="line">    @echo $(word 5,aa bb cc dd)</span><br><span class="line">    @echo $(word 4,aa bb cc dd)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">aa</span><br><span class="line"></span><br><span class="line">dd</span><br></pre></td></tr></table></figure><p></p><p><strong>取单词串函数: $(wordlist &lt;s&gt;,&lt;e&lt;text&gt;)</strong></p><p>功能: 从字符串&lt;text&gt;中取从&lt;s&gt;开始到&lt;e&gt;的单词串. &lt;s&gt;和&lt;e&gt;是一个数字.</p><p>返回: 从&lt;s&gt;到&lt;e&gt;的字符串<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(wordlist 1,3,aa bb cc dd)</span><br><span class="line">    @echo $(word 5,6,aa bb cc dd)</span><br><span class="line">    @echo $(word 2,5,aa bb cc dd)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">aa bb cc</span><br><span class="line"></span><br><span class="line">bb</span><br></pre></td></tr></table></figure><p></p><p><strong>单词个数统计函数: $(words &lt;text&gt;)</strong></p><p>功能: 统计字符串 &lt;text&gt; 中单词的个数</p><p>返回: 单词个数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo $(words aa bb cc dd)</span><br><span class="line">    @echo $(words aabbccdd)</span><br><span class="line">    @echo $(words )</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">4</span><br><span class="line">1</span><br><span class="line">0</span><br></pre></td></tr></table></figure><p><strong>首单词函数: $(firstword &lt;text&gt;)</strong></p><p>功能: 取字符串 &lt;text&gt; 中的第一个单词</p><p>返回: 字符串 &lt;text&gt; 中的第一个单词<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(firstword aa bb cc dd)</span><br><span class="line">    @echo $(firstword aabbccdd)</span><br><span class="line">    @echo $(firstword )</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">aa</span><br><span class="line">aabbccdd</span><br></pre></td></tr></table></figure><p></p><h4 id="3-4-2-文件名函数"><a href="#3-4-2-文件名函数" class="headerlink" title="3.4.2 文件名函数"></a><strong>3.4.2 文件名函数</strong></h4><p><strong>取目录函数: $(dir &lt;names…&gt;)</strong></p><p>功能: 从文件名序列 &lt;names&gt; 中取出目录部分</p><p>返回: 文件名序列 &lt;names&gt; 中的目录部分</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(dir /home/a.c ./bb.c ../c.c d.c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">/home/ ./ ../ ./</span><br></pre></td></tr></table></figure><p><strong>取文件函数: $(notdir &lt;names…&gt;)</strong></p><p>功能: 从文件名序列 &lt;names&gt; 中取出非目录部分</p><p>返回: 文件名序列 &lt;names&gt; 中的非目录部分</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(notdir /home/a.c ./bb.c ../c.c d.c)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">a.c bb.c c.c d.c</span><br></pre></td></tr></table></figure><p><strong>取后缀函数: $(suffix &lt;names…&gt;)</strong></p><p>功能: 从文件名序列 &lt;names&gt; 中取出各个文件名的后缀</p><p>返回: 文件名序列 &lt;names&gt; 中各个文件名的后缀, 没有后缀则返回空字符串</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(suffix /home/a.c ./b.o ../c.a d)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">.c .o .a</span><br></pre></td></tr></table></figure><p><strong>取前缀函数: $(basename &lt;names…&gt;)</strong></p><p>功能: 从文件名序列 &lt;names&gt; 中取出各个文件名的前缀</p><p>返回: 文件名序列 &lt;names&gt; 中各个文件名的前缀, 没有前缀则返回空字符串</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(basename /home/a.c ./b.o ../c.a /home/.d .e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">/home/a ./b ../c /home/</span><br></pre></td></tr></table></figure><p><strong>加后缀函数: $(addsuffix &lt;suffix&gt;,&lt;names…&gt;)</strong></p><p>功能: 把后缀 &lt;suffix&gt; 加到 &lt;names&gt; 中的每个单词后面</p><p>返回: 加过后缀的文件名序列</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(addsuffix .c,/home/a b ./c.o ../d.c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">/home/a.c b.c ./c.o.c ../d.c.c</span><br></pre></td></tr></table></figure><p><strong>加前缀函数: $(addprefix &lt;prefix&gt;,&lt;names…&gt;)</strong></p><p>功能: 把前缀 &lt;prefix&gt; 加到 &lt;names&gt; 中的每个单词前面</p><p>返回: 加过前缀的文件名序列</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(addprefix test_,/home/a.c b.c ./d.c)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">test_/home/a.c test_b.c test_./d.c</span><br></pre></td></tr></table></figure><p><strong>连接函数: $(join &lt;list1&gt;,&lt;list2&gt;)</strong></p><p>功能: &lt;list2&gt; 中对应的单词加到 &lt;list1&gt; 后面</p><p>返回: 连接后的字符串</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    @echo $(join a b c d,1 2 3 4)</span><br><span class="line">    @echo $(join a b c d,1 2 3 4 5)</span><br><span class="line">    @echo $(join a b c d e,1 2 3 4)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">a1 b2 c3 d4</span><br><span class="line">a1 b2 c3 d4 5</span><br><span class="line">a1 b2 c3 d4 e</span><br></pre></td></tr></table></figure><h4 id="3-4-3-foreach"><a href="#3-4-3-foreach" class="headerlink" title="3.4.3 foreach"></a><strong>3.4.3 foreach</strong></h4><p><strong>语法:</strong></p><p>$(foreach &lt;var&gt;,&lt;list&gt;,&lt;text&gt;)</p><p><strong>示例:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">targets := a b c d</span><br><span class="line">objects := $(foreach i,$(targets),$(i).o)</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo $(targets)</span><br><span class="line">    @echo $(objects)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">a b c d</span><br><span class="line">a.o b.o c.o d.o</span><br></pre></td></tr></table></figure><h4 id="3-4-4-if"><a href="#3-4-4-if" class="headerlink" title="3.4.4 if"></a><strong>3.4.4 if</strong></h4><p>这里的if是个函数, 和前面的条件判断不一样, 前面的条件判断属于Makefile的关键字</p><p><strong>语法:</strong></p><p>$(if &lt;condition&gt;,&lt;then-part&gt;)</p><p>$(if &lt;condition&gt;,&lt;then-part&gt;,&lt;else-part&gt;)</p><p><strong>示例:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">val := a</span><br><span class="line">objects := $(if $(val),$(val).o,nothing)</span><br><span class="line">no-objects := $(if $(no-val),$(val).o,nothing)</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo $(objects)</span><br><span class="line">    @echo $(no-objects)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">a.o</span><br><span class="line">nothing</span><br></pre></td></tr></table></figure><h4 id="3-4-5-call-创建新的参数化函数"><a href="#3-4-5-call-创建新的参数化函数" class="headerlink" title="3.4.5 call - 创建新的参数化函数"></a><strong>3.4.5 call - 创建新的参数化函数</strong></h4><p><strong>语法:</strong></p><p>$(call &lt;expression&gt;,&lt;parm1&gt;,&lt;parm2&gt;,&lt;parm3&gt;…)</p><p><strong>示例:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">log = &quot;====debug====&quot; $(1) &quot;====end====&quot;</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo $(call log,&quot;正在 Make&quot;)</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">====debug==== 正在 Make ====end====</span><br></pre></td></tr></table></figure><h4 id="3-4-6-origin-判断变量的来源"><a href="#3-4-6-origin-判断变量的来源" class="headerlink" title="3.4.6 origin - 判断变量的来源"></a><strong>3.4.6 origin - 判断变量的来源</strong></h4><p><strong>语法:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(origin &lt;variable&gt;)</span><br></pre></td></tr></table></figure><p>返回值有如下类型:</p><div class="table-container"><table><thead><tr><th><strong>类型</strong></th><th><strong>含义</strong></th></tr></thead><tbody><tr><td>all</td><td>所有目标的目标，其功能一般是编译所有的目标</td></tr><tr><td>clean</td><td>删除所有被make创建的文件</td></tr><tr><td>install</td><td>安装已编译好的程序，其实就是把目标可执行文件拷贝到指定的目录中去</td></tr><tr><td>print</td><td>列出改变过的源文件</td></tr><tr><td>tar</td><td>把源程序打包备份. 也就是一个tar文件</td></tr><tr><td>dist</td><td>创建一个压缩文件, 一般是把tar文件压成Z文件. 或是gz文件</td></tr><tr><td>TAGS</td><td>更新所有的目标, 以备完整地重编译使用</td></tr><tr><td>check 或 test</td><td>一般用来测试makefile的流程</td></tr></tbody></table></div><p><strong>示例:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">val-in-file := test-file</span><br><span class="line">override val-override := test-override</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">    @echo $(origin not-define)    # not-define 没有定义</span><br><span class="line">    @echo $(origin CC)            # CC 是Makefile默认定义的变量</span><br><span class="line">    @echo $(origin PATH)         # PATH 是 bash 环境变量</span><br><span class="line">    @echo $(origin val-in-file)    # 此Makefile中定义的变量</span><br><span class="line">    @echo $(origin val-in-cmd)    # 这个变量会加在 make 的参数中</span><br><span class="line">    @echo $(origin val-override) # 此Makefile中定义的override变量</span><br><span class="line">    @echo $(origin @)             # 自动变量, 具体前面的介绍</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make val-in-cmd=val-cmd</span><br><span class="line">undefined</span><br><span class="line">default</span><br><span class="line">environment</span><br><span class="line">file</span><br><span class="line">command line</span><br><span class="line">override</span><br><span class="line">automatic</span><br></pre></td></tr></table></figure><h4 id="3-4-7-shell"><a href="#3-4-7-shell" class="headerlink" title="3.4.7 shell"></a><strong>3.4.7 shell</strong></h4><p><strong>语法:</strong></p><p>$(shell &lt;shell command&gt;)</p><p>它的作用就是执行一个shell命令, 并将shell命令的结果作为函数的返回.</p><p>作用和 <code>&lt;shell command&gt;</code> 一样, <strong>`</strong> 是反引号</p><h4 id="3-4-8-make-控制函数"><a href="#3-4-8-make-控制函数" class="headerlink" title="3.4.8 make 控制函数"></a><strong>3.4.8 make 控制函数</strong></h4><p><strong>产生一个致命错误: $(error &lt;text …&gt;)</strong></p><p>功能: 输出错误信息, 停止Makefile的运行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    $(error there is an error!)</span><br><span class="line">    @echo &quot;这里不会执行!&quot;</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">Makefile:2: *** there is an error!.  Stop.</span><br></pre></td></tr></table></figure><p><strong>输出警告: $(warning &lt;text …&gt;)</strong></p><p>功能: 输出警告信息, Makefile继续运行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Makefile 内容</span><br><span class="line">all:</span><br><span class="line">    $(warning there is an warning!)</span><br><span class="line">    @echo &quot;这里会执行!&quot;</span><br><span class="line"></span><br><span class="line"># bash 中执行 make</span><br><span class="line">$ make</span><br><span class="line">Makefile:2: there is an warning!</span><br><span class="line">这里会执行!</span><br></pre></td></tr></table></figure><h3 id="3-5-Makefile中一些GNU约定俗成的伪目标"><a href="#3-5-Makefile中一些GNU约定俗成的伪目标" class="headerlink" title="3.5 Makefile中一些GNU约定俗成的伪目标"></a><strong>3.5 Makefile中一些GNU约定俗成的伪目标</strong></h3><p>如果有过在Linux上, 从源码安装软件的经历的话, 就会对 make clean, make install 比较熟悉.</p><p>像 clean, install 这些伪目标, 广为人知, 不用解释就大家知道是什么意思了.</p><p>下面列举一些常用的伪目标, 如果在自己项目的Makefile合理使用这些伪目标的话, 可以让我们自己的Makefile看起来更专业, 呵呵 :)</p><div class="table-container"><table><thead><tr><th><strong>伪目标</strong></th><th><strong>含义</strong></th></tr></thead><tbody><tr><td>all</td><td>所有目标的目标，其功能一般是编译所有的目标</td></tr><tr><td>clean</td><td>删除所有被make创建的文件</td></tr><tr><td>install</td><td>安装已编译好的程序，其实就是把目标可执行文件拷贝到指定的目录中去</td></tr><tr><td>print</td><td>列出改变过的源文件</td></tr><tr><td>tar</td><td>把源程序打包备份. 也就是一个tar文件</td></tr><tr><td>dist</td><td>创建一个压缩文件, 一般是把tar文件压成Z文件. 或是gz文件</td></tr><tr><td>TAGS</td><td>更新所有的目标, 以备完整地重编译使用</td></tr><tr><td>check 或 test</td><td>一般用来测试makefile的流程</td></tr></tbody></table></div></div><div><div style="text-align:center;color:#ccc;font-size:14px">------ 本文结束------</div></div><div class="reward-container"><div>坚持原创技术分享，您的支持将鼓励我继续创作！</div> <button onclick='var qr=document.getElementById("qr");qr.style.display="none"===qr.style.display?"block":"none"'> 打赏</button><div id="qr" style="display:none"><div style="display:inline-block"> <img src="/uploads/wechat.png" alt="zdaiot 微信支付"><p>微信支付</p></div><div style="display:inline-block"> <img src="/uploads/aipay.jpg" alt="zdaiot 支付宝"><p>支付宝</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> zdaiot</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.zdaiot.com/C/Make&Debug/Makefile/" title="Makefile">https://www.zdaiot.com/C/Make&Debug/Makefile/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="followme"><p>欢迎关注我的其它发布渠道</p><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="/uploads/wechat-qcode.jpg"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">WeChat</span></a></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Makefile/" rel="tag"><i class="fa fa-tag"></i> Makefile</a></div><div class="post-nav"><div class="post-nav-item"><a href="/ImageProcessing/图像压缩入门/" rel="prev" title="图像压缩入门"><i class="fa fa-chevron-left"></i> 图像压缩入门</a></div><div class="post-nav-item"> <a href="/C/Make&Debug/Makefile具体工程/" rel="next" title="Makefile具体工程">Makefile具体工程<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Makefile-简介"><span class="nav-number">1.</span> <span class="nav-text">1. Makefile 简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-Makefile-主要的-5个部分-显示规则-隐晦规则-变量定义-文件指示-注释"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 Makefile 主要的 5个部分 (显示规则, 隐晦规则, 变量定义, 文件指示, 注释)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-GNU-make-的工作方式"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 GNU make 的工作方式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Makefile-初级语法"><span class="nav-number">2.</span> <span class="nav-text">2. Makefile 初级语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-Makefile-规则"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 Makefile 规则</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-规则语法"><span class="nav-number">2.1.1.</span> <span class="nav-text">2.1.1 规则语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-2-规则中的通配符"><span class="nav-number">2.1.2.</span> <span class="nav-text">2.1.2 规则中的通配符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-3-路径搜索"><span class="nav-number">2.1.3.</span> <span class="nav-text">2.1.3 路径搜索</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-Makefile-中的变量"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 Makefile 中的变量</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-变量定义-or"><span class="nav-number">2.2.1.</span> <span class="nav-text">2.2.1 变量定义 ( = or := )</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-变量替换"><span class="nav-number">2.2.2.</span> <span class="nav-text">2.2.2 变量替换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-变量追加值"><span class="nav-number">2.2.3.</span> <span class="nav-text">2.2.3 变量追加值 +=</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-4-变量覆盖-override"><span class="nav-number">2.2.4.</span> <span class="nav-text">2.2.4 变量覆盖 override</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-5-目标变量"><span class="nav-number">2.2.5.</span> <span class="nav-text">2.2.5 目标变量</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-Makefile-命令前缀"><span class="nav-number">2.3.</span> <span class="nav-text">2.3 Makefile 命令前缀</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-伪目标"><span class="nav-number">2.4.</span> <span class="nav-text">2.4 伪目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-引用其他的-Makefile"><span class="nav-number">2.5.</span> <span class="nav-text">2.5 引用其他的 Makefile</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-查看C文件的依赖关系"><span class="nav-number">2.6.</span> <span class="nav-text">2.6 查看C文件的依赖关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-make-退出码"><span class="nav-number">2.7.</span> <span class="nav-text">2.7 make 退出码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-8-指定-Makefile，-指定特定目标"><span class="nav-number">2.8.</span> <span class="nav-text">2.8 指定 Makefile， 指定特定目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-9-make-参数介绍"><span class="nav-number">2.9.</span> <span class="nav-text">2.9 make 参数介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-10-Makefile-隐含规则"><span class="nav-number">2.10.</span> <span class="nav-text">2.10 Makefile 隐含规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-11-隐含规则中的-命令变量-和-命令参数变量"><span class="nav-number">2.11.</span> <span class="nav-text">2.11 隐含规则中的 命令变量 和 命令参数变量</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-11-1-命令变量-书写Makefile可以直接写-shell时用这些变量"><span class="nav-number">2.11.1.</span> <span class="nav-text">2.11.1 命令变量, 书写Makefile可以直接写 shell时用这些变量.</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-11-2-命令参数变量"><span class="nav-number">2.11.2.</span> <span class="nav-text">2.11.2 命令参数变量</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-12-自动变量"><span class="nav-number">2.12.</span> <span class="nav-text">2.12 自动变量</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Makefile-高级语法"><span class="nav-number">3.</span> <span class="nav-text">3. Makefile 高级语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-嵌套Makefile"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 嵌套Makefile</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-定义命令包"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 定义命令包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-条件判断"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 条件判断</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-Makefile-中的函数"><span class="nav-number">3.4.</span> <span class="nav-text">3.4 Makefile 中的函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-1-字符串函数"><span class="nav-number">3.4.1.</span> <span class="nav-text">3.4.1 字符串函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-2-文件名函数"><span class="nav-number">3.4.2.</span> <span class="nav-text">3.4.2 文件名函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-3-foreach"><span class="nav-number">3.4.3.</span> <span class="nav-text">3.4.3 foreach</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-4-if"><span class="nav-number">3.4.4.</span> <span class="nav-text">3.4.4 if</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-5-call-创建新的参数化函数"><span class="nav-number">3.4.5.</span> <span class="nav-text">3.4.5 call - 创建新的参数化函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-6-origin-判断变量的来源"><span class="nav-number">3.4.6.</span> <span class="nav-text">3.4.6 origin - 判断变量的来源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-7-shell"><span class="nav-number">3.4.7.</span> <span class="nav-text">3.4.7 shell</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-8-make-控制函数"><span class="nav-number">3.4.8.</span> <span class="nav-text">3.4.8 make 控制函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-Makefile中一些GNU约定俗成的伪目标"><span class="nav-number">3.5.</span> <span class="nav-text">3.5 Makefile中一些GNU约定俗成的伪目标</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="zdaiot" src="/uploads/avatar.png"><p class="site-author-name" itemprop="name">zdaiot</p><div class="site-description" itemprop="description">404NotFound</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">327</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">55</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">382</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/zdaiot" title="GitHub → https://github.com/zdaiot" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:zdaiot@163.com" title="E-Mail → mailto:zdaiot@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/" title="知乎 → https://www.zhihu.com/people/" rel="noopener" target="_blank"><i class="fa fa-book fa-fw"></i> 知乎</a></span><span class="links-of-author-item"><a href="https://blog.csdn.net/zdaiot" title="CSDN → https://blog.csdn.net/zdaiot" rel="noopener" target="_blank"><i class="fa fa-copyright fa-fw"></i> CSDN</a></span></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="link fa-fw"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="https://kalacloud.com" title="https://kalacloud.com" rel="noopener" target="_blank">卡拉云低代码工具</a></li></ul></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="https://beian.miit.gov.cn" rel="noopener" target="_blank">京ICP备2021031914号</a></div><div class="copyright"> &copy; <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">zdaiot</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-chart-area"></i></span> <span title="站点总字数">2.3m</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span title="站点阅读时长">35:03</span></div><div class="addthis_inline_share_toolbox"><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5b5e7e498f94b7ad" async="async"></script></div> <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>var now=new Date;function createtime(){var n=new Date("08/01/2018 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="Run for "+dnum+" Days ",document.getElementById("times").innerHTML=hnum+" Hours "+mnum+" m "+snum+" s"}setInterval("createtime()",250)</script><div class="busuanzi-count"><script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script><script data-pjax>!function(){var o,n,e=document.getElementsByTagName("link");if(0<e.length)for(i=0;i<e.length;i++)"canonical"==e[i].rel.toLowerCase()&&e[i].href&&(o=e[i].href);n=o?o.split(":")[0]:window.location.protocol.split(":")[0],o||(o=window.location.href),function(){var e=o,i=document.referrer;if(!/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(e)){var t="https"===String(n).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";i?(t+="?r="+encodeURIComponent(document.referrer),e&&(t+="&l="+e)):e&&(t+="?l="+e),(new Image).src=t}}(window)}()</script><script src="/js/local-search.js"></script><div id="pjax"><script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '4800250e682fe873198b',
      clientSecret: '80f7f33f5f8ddfd3944f455cabadda4ff3299147',
      repo        : 'zdaiot.github.io',
      owner       : 'zdaiot',
      admin       : ['zdaiot'],
      id          : 'cf91bbf20b525b4c21f36d3fecc3d44b',
        language: '',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,log:!1,model:{jsonPath:"/live2dw/assets/wanko.model.json"},display:{position:"left",width:150,height:300},mobile:{show:!0}})</script></body></html>